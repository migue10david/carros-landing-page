---
import "../styles/global.css";
import LanguagePicker from "./LanguagePicker.astro";

import { getLangFromUrl, useTranslation } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslation(lang);

---

<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

<header 
  x-data="{ open: false }"
  @click.outside="open = false"
  class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-gray-200 dark:bg-gray-900/95 dark:border-gray-700 shadow-sm"
>
  <nav class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-20">
      
      <!-- Logo -->
      <div class="flex items-center">
        <a href={`/${lang}`} class="flex items-center space-x-2 group">
          <!-- <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-200">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
          </div> -->
          <img src="/images/logo.png" alt="logo" class="w-16 h-16 md:w-20 md:h-20" class="object-contain" />
          <span class="text-xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent dark:from-blue-400 dark:to-cyan-400">
            Cuba Easy Tours
          </span>
        </a>
      </div>

      <!-- Desktop Menu -->
      <div class="hidden md:block">
        <div class="ml-10 flex items-baseline space-x-1">
          <a href={`/${lang}`} class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-900 hover:text-blue-600 hover:bg-blue-50 dark:text-gray-100 dark:hover:text-blue-400 dark:hover:bg-gray-800 transition-all duration-200
            ${Astro.url.pathname === '/' ? 'text-blue-600 bg-blue-50 dark:text-blue-400 dark:bg-gray-800' : ''}">
            {t("navbar_home")}
          </a>
          <a href={`/${lang}/contact`} class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 dark:text-gray-300 dark:hover:text-blue-400 dark:hover:bg-gray-800 transition-all duration-200
            ${Astro.url.pathname === '/contact' ? 'text-blue-600 bg-blue-50 dark:text-blue-400 dark:bg-gray-800' : ''}">
            {t("navbar_contact")}
          </a>
        </div>
      </div>
      <LanguagePicker/>

      <!-- CTA Button & Mobile menu button -->
      <div class="flex items-center space-x-4">
        <!-- CTA Button (hidden on mobile) -->

        <!-- Mobile menu button -->
        <button 
          type="button" 
          class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-blue-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-blue-400 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 transition-colors duration-200"
          @click.stop="open = !open"
          :aria-expanded="open"
          aria-controls="mobile-menu"
        >
          <span class="sr-only">Abrir men√∫ principal</span>
          <!-- Hamburger icon -->
          <svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" x-show="!open">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <!-- Close icon -->
          <svg class="hidden h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" x-show="open">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div 
      id="mobile-menu" 
      x-show="open"
      x-transition:enter="transition ease-out duration-200"
      x-transition:enter-start="opacity-0 scale-95"
      x-transition:enter-end="opacity-100 scale-100"
      x-transition:leave="transition ease-in duration-150"
      x-transition:leave-start="opacity-100 scale-100"
      x-transition:leave-end="opacity-0 scale-95"
      class="md:hidden origin-top bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"
    >
      <div class="px-2 pt-2 pb-3 space-y-1">
        <a href={`/${lang}`} @click="open = false" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-900 hover:text-blue-600 hover:bg-blue-50 dark:text-gray-100 dark:hover:text-blue-400 dark:hover:bg-gray-800 transition-all duration-200
          ${Astro.url.pathname === '/' ? 'text-blue-600 bg-blue-50 dark:text-blue-400 dark:bg-gray-800' : ''}">
          {t("navbar_home")}
        </a>

        <a href={`/${lang}/contact`} @click="open = false" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-900 hover:text-blue-600 hover:bg-blue-50 dark:text-gray-100 dark:hover:text-blue-400 dark:hover:bg-gray-800 transition-all duration-200
          ${Astro.url.pathname === '/contact' ? 'text-blue-600 bg-blue-50 dark:text-blue-400 dark:bg-gray-800' : ''}">
          {t("navbar_contact")}
        </a>
        <!-- Mobile CTA -->
      </div>
    </div>
  </nav>
</header>

<style>
  /* Soporte para backdrop blur */
  @supports (backdrop-filter: blur(8px)) {
    header {
      backdrop-filter: blur(8px);
    }
  }
</style>