---
import { languages } from "../i18n/ui";
import { getLangFromUrl } from "../i18n/utils";
const currentPath = Astro.url.pathname;
const lang = getLangFromUrl(Astro.url);
const basePath = currentPath.replace(/^\/(?:[a-z]{2})/, "") || "/";
---

<div class="relative inline-flex rounded-md shadow-sm">
  <select 
    id="switcher"
    class="appearance-none w-full md:w-48 pl-3 pr-10 py-2.5 text-base font-medium  border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400 dark:hover:border-gray-500"
  >
    {Object.entries(languages).map(([code, name]) => {
      const isSelected = lang === code;
      return (
        <option 
          value={`/${code}`} 
          selected={isSelected}
          class="flex items-center gap-2 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800"
        >
          {code === 'en' ? '🇺🇸 ' : '🇷🇺 '}
          {name}
        </option>
      );
    })}
  </select>
  
  <!-- Ícono de flecha personalizado -->
  <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
    <svg class="h-5 w-5 text-gray-400 dark:text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
    </svg>
  </div>
</div>

<script>
    const switcher = document.getElementById("switcher");
    if(switcher){
        switcher.addEventListener("change", (e) => {
            const target = e.target as HTMLSelectElement;
            window.location.href = target.value
        })
    }
</script>

<style>
  /* Estilos para las opciones con banderas */
  option {
    padding: 8px;
    display: flex;
    align-items: center;
  }
  
  /* Mejora la apariencia en navegadores WebKit */
  select {
    background-image: none;
  }
  
  /* Mejora la apariencia en Firefox */
  select option {
    background-color: white;
  }
  
  @media (prefers-color-scheme: dark) {
    select option {
      background-color: #1f2937;
    }
  }
</style>